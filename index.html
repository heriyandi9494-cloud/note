
<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Pengeluaran Harian</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
<style>
    table.table th,
    table.table td {
        border: 2px solid #edc308 !important;
    }
    #tabelData td,
    #tabelData th {
    border: 2px solid #171818 !important;
}

</style>

    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container my-4">
<div class="row g-3 mb-3">
    <div class="col-12 col-md-12">
        <div class="card text-bg-warning">
            <div class="card-body">
                <h6>êœ±Éªêœ±á´€ êœ±á´€ÊŸá´…á´</h6>
                <h3 id="saldo">Rell 0</h3>
            </div>
        </div>
    </div>
</div>
    <!-- CARD -->
    <div class="row g-3">
        <div class="col-12 col-md-6">
            <div class="card text-bg-primary">
                <div class="card-body">
                    <h6>á´˜á´‡É´É¢á´‡ÊŸá´œá´€Ê€á´€É´ Êœá´€Ê€Éªá´€É´</h6>
                    <h3 id="harian">Rell 0</h3>
                </div>
            </div>
        </div>
        <div class="col-12 col-md-6">
            <div class="card text-bg-success">
                <div class="card-body">
                    <h6>á´›á´á´›á´€ÊŸ á´˜á´‡É´É¢á´‡ÊŸá´œá´€Ê€á´€É´</h6>
                    <h3 id="total">Rell 0</h3>
                </div>
            </div>
        </div>
    </div>

    <!-- BUTTON -->
    <div class="d-grid my-3">
        <button class="btn btn-dark" data-bs-toggle="modal" data-bs-target="#modalTambah">
            + á´›á´€á´Ê™á´€Êœ á´˜á´‡É´É¢á´‡ÊŸá´œá´€Ê€á´€É´
        </button>
    </div>
<div class="card my-3">
    <div class="card-body">
        <label class="form-label fw-bold">ğšƒğšŠğš–ğš‹ğšŠğš”ğšŠğš— ğšœğšŠğš•ğšğš˜ ğšŠğš ğšŠğš•</label>
        <div class="input-group">
            <input type="number" id="saldoAwalInput" class="form-control" placeholder="ğ™¼ğšŠğšœğšğš”ğš”ğšŠğš— ğšœğšŠğš•ğšğš˜ ğšŠğš ğšŠğš•">
            <button class="btn btn-success" onclick="simpanSaldo()">
                êœ±Éªá´á´˜á´€É´
            </button>
        </div>
    </div>
</div>

<div class="card my-3">
    <div class="card-body">
        <div class="row g-2">
            <div class="col-8">
                <input type="date" id="filterTanggal" class="form-control">
            </div>
            <div class="col-4 d-grid">
                <button class="btn btn-warning" onclick="filterTanggal()">
                    êœ°ÉªÊŸá´›á´‡Ê€
                </button>
            </div>
        </div>
    </div>
</div>

    <!-- TABLE -->
    <div class="table-responsive">
        <table class="table table-bordered table-striped text-center">
            <thead class="table-dark">
                <tr>
                    <th>ğ•‹ğ•’ğ•Ÿğ•˜ğ•˜ğ•’ğ•</th>
                    <th>ğ•‚ğ•–ğ•¥ğ•–ğ•£ğ•’ğ•Ÿğ•˜ğ•’ğ•Ÿ</th>
                    <th>â„•ğ• ğ•ğ•šğ•Ÿğ•’ğ•</th>
                    <th>ğŸ’² Kurs</th>
                    <th>â„‚ğ•–ğ•Ÿğ•¥ğ•’ğ•Ÿğ•˜</th>
                    <th>Aksi</th>
                </tr>
            </thead>
            <tbody id="tabelData"></tbody>
        </table>
    </div>
</div>

<!-- MODAL -->
<div class="modal fade" id="modalTambah">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5>Tambah Pengeluaran</h5>
                <button class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <div class="modal-body">
                <input type="date" id="tanggal" class="form-control mb-2">
                <input type="text" id="keterangan" class="form-control mb-2" placeholder="Keterangan">
                <input type="number" id="nominal" class="form-control mb-2" placeholder="Nominal">
            </div>

            <div class="modal-footer">
                <button class="btn btn-primary" onclick="simpanData()">Simpan</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="modalFilter">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5>Êœá´€êœ±ÉªÊŸ êœ°ÉªÊŸá´›á´‡Ê€</h5>
                <button class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <div class="modal-body">
                <div class="table-responsive">
                    <table class="table table-bordered text-center">
                        <thead class="table-dark">
                            <tr>
                                <th>á´›á´€É´É¢É¢á´€ÊŸ</th>
                                <th>á´‹á´‡á´›á´‡Ê€á´€É´É¢á´€É´</th>
                                <th>É´á´á´ÉªÉ´á´€ÊŸ</th>
                                <th>Êœá´€á´˜á´œêœ±</th>
                            </tr>
                        </thead>
                        <tbody id="tabelFilter"></tbody>
                    </table>
                </div>

                <div class="text-end fw-bold mt-2">
                    Total: <span id="totalFilter">Rell 0</span>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
    // ğŸ”¥ KONFIGURASI FIREBASE
const firebaseConfig = {
  apiKey: "AIzaSyAtQ1z2lncUe28cNG0nISDlJUa_wvQs8Aw",
  authDomain: "jamtidur-c9cde.firebaseapp.com",
  databaseURL: "https://jamtidur-c9cde-default-rtdb.firebaseio.com",
  projectId: "jamtidur-c9cde",
  storageBucket: "jamtidur-c9cde.firebasestorage.app",
  messagingSenderId: "88768167990",
  appId: "1:88768167990:web:f72e7cdd276444daccd897",
  measurementId: "G-Y7QKWKHPLH"
};

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
let saldoAwal = 0;

firebase.database().ref("saldo").on("value", snap => {
    saldoAwal = snap.val() || 0;
    hitungSaldo();
});
function simpanSaldo() {
    const inputSaldo = parseInt(
        document.getElementById("saldoAwalInput").value
    );

    if (isNaN(inputSaldo) || inputSaldo <= 0) {
        alert("Masukkan saldo yang valid");
        return;
    }

    const saldoRef = firebase.database().ref("saldo");

    saldoRef.once("value").then(snapshot => {
        const saldoLama = snapshot.val() || 0;
        const saldoBaru = saldoLama + inputSaldo;

        saldoRef.set(saldoBaru);
        document.getElementById("saldoAwalInput").value = "";
    });
}
function filterTanggal() {
    const tanggal = document.getElementById("filterTanggal").value;
    const tabelFilter = document.getElementById("tabelFilter");
    const totalFilter = document.getElementById("totalFilter");

    if (!tanggal) {
        alert("Silakan pilih tanggal");
        return;
    }

    tabelFilter.innerHTML = "";
    let total = 0;

    firebase.database().ref("pengeluaran").once("value", snapshot => {
        snapshot.forEach(item => {
            const d = item.val();

            if (d.tanggal === tanggal) {
                total += d.nominal;
tabelFilter.innerHTML += `
<tr>
    <td>${d.tanggal}</td>
    <td>${d.keterangan}</td>
    <td>Rell ${d.nominal.toLocaleString()}</td>
    <td>
        <button class="btn btn-danger btn-sm"
            onclick="hapusData('${item.key}')">
            Hapus
        </button>
    </td>
</tr>
`;

            }
        });

        totalFilter.innerText = "Rell " + total.toLocaleString();

        // tampilkan modal
        const modal = new bootstrap.Modal(
            document.getElementById("modalFilter")
        );
        modal.show();
    });
}
    const tabel = document.getElementById("tabelData");

    function simpanData() {
        const data = {
            tanggal: tanggal.value,
            keterangan: keterangan.value,
            nominal: parseInt(nominal.value),
            cek: false
        };

        db.ref("pengeluaran").push(data);
        document.querySelector("form")?.reset();
        bootstrap.Modal.getInstance(document.getElementById('modalTambah')).hide();
    }

    db.ref("pengeluaran").on("value", snapshot => {
        tabel.innerHTML = "";
        let total = 0;
        let harian = 0;

        snapshot.forEach(item => {
            const d = item.val();
            const id = item.key;

            if (d.cek) {
                total += d.nominal;
            } else {
                harian += d.nominal;
            }

const kursUSD = (d.nominal / 4000).toFixed(2);

tabel.innerHTML += `
<tr>
    <td>${d.tanggal}</td>
    <td>${d.keterangan}</td>
    <td>Rell ${d.nominal.toLocaleString()}</td>
    <td>$ ${kursUSD}</td>
    <td>
        <input type="checkbox" ${d.cek ? "checked" : ""} 
        onchange="toggleCek('${id}', this.checked)">
    </td>
    <td>
        <button class="btn btn-danger btn-sm"
            onclick="hapusData('${id}')">
            Hapus
        </button>
    </td>
</tr>
`;

        });

document.getElementById("total").innerText =
    "Rell" + total.toLocaleString();

document.getElementById("harian").innerText =
    "Rell " + harian.toLocaleString();

hitungSaldo(total);

    });

    function toggleCek(id, status) {
        db.ref("pengeluaran/" + id).update({ cek: status });
    }
    function hapusData(id) {
    if (confirm("Yakin ingin menghapus data ini?")) {
        firebase.database()
            .ref("pengeluaran/" + id)
            .remove();
    }
}
function hitungSaldo(totalPengeluaran = 0) {
    const saldoAkhir = saldoAwal - totalPengeluaran;
    document.getElementById("saldo").innerText =
        "Rell " + saldoAkhir.toLocaleString();
}

</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
